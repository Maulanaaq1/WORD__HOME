<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Laporan - WORD NET</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .card-summary { border-radius: 15px; }
    .card-summary h4 { font-weight: bold; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-4">
  <a class="navbar-brand fw-bold me-5" href="#">
    <img src="Word.png" alt="Logo" height="30" class="d-inline-block align-text-top">
  </a>
  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
    <span class="navbar-toggler-icon"></span>
  </button>
<!-- Isi navbar -->
  <div class="collapse navbar-collapse" id="navbarContent">
    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      <li class="nav-item"><a class="nav-link" href="laporan.html"><i class="fas fa-chart-line"></i> Laporan</a></li>
      <li class="nav-item"><a class="nav-link" href="absen.html"><i class="fas fa-user-check"></i> Absen</a></li>
      <li class="nav-item"><a class="nav-link" href="pemasukan.html"><i class="fas fa-wallet"></i> Pemasukan</a></li>
      <li class="nav-item"><a class="nav-link" href="pengeluaran.html"><i class="fas fa-money-bill-wave"></i> Pengeluaran</a></li>
      <li class="nav-item"><a class="nav-link" href="asset.html"><i class="fas fa-box"></i> Assets</a></li>
      <li class="nav-item"><a class="nav-link" href="Instalasi.html"><i class="fas fa-clipboard"></i> Instalasi</a></li>
      <li class="nav-item"><a class="nav-link" href="Approval.html"><i class="fas fa-check-circle"></i> Approval</a></li>
      <li class="nav-item"><a class="nav-link" href="pelanggan.html"><i class="fas fa-users"></i> Pelanggan</a></li>
    </ul>
    <a class="nav-link text-danger" href="index.html"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>
</nav>


<div class="container my-4">
  <h3 class="mb-4 fw-bold text-center">ðŸ“Š Dashboard Laporan</h3>

  <!-- Ringkasan -->
  <div class="row g-3">
    <div class="col-md-3">
      <div class="card card-summary shadow text-center p-3 bg-success text-white">
        <h4>Total Pemasukan</h4>
        <p id="totalPemasukan">Rp 0</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-summary shadow text-center p-3 bg-danger text-white">
        <h4>Total Pengeluaran</h4>
        <p id="totalPengeluaran">Rp 0</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-summary shadow text-center p-3 bg-primary text-white">
        <h4>Total Pelanggan</h4>
        <p id="totalPelanggan">0</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-summary shadow text-center p-3 bg-warning text-dark">
        <h4>Total Asset</h4>
        <p id="totalAsset">0</p>
      </div>
    </div>
  </div>

  <!-- Grafik -->
  <div class="card shadow mt-4 p-3">
    <h5 class="fw-bold text-center">Grafik Pemasukan vs Pengeluaran</h5>
    <canvas id="chartKeuangan"></canvas>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDCougF9lDyP70dCwngEQApRMgk6VPRj90",
    authDomain: "wordhome-9ffd0.firebaseapp.com",
    databaseURL: "https://wordhome-9ffd0-default-rtdb.firebaseio.com",
    projectId: "wordhome-9ffd0",
    storageBucket: "wordhome-9ffd0.firebasestorage.app",
    messagingSenderId: "907251172383",
    appId: "1:907251172383:web:d71150b40f0b274994c12a",
    measurementId: "G-WL5VGK0W4J"
  };
  if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }

  const pemasukanDB = firebase.database().ref("pemasukan");
  const pengeluaranDB = firebase.database().ref("pengeluaran");
  const pelangganDB = firebase.database().ref("pelanggan");
  const assetDB = firebase.database().ref("asset");

  let totalMasuk = 0, totalKeluar = 0;

  pemasukanDB.on("value", snap=>{
    totalMasuk = 0;
    snap.forEach(c => totalMasuk += parseInt(c.val().jumlah || 0));
    document.getElementById("totalPemasukan").innerText = "Rp " + totalMasuk.toLocaleString("id-ID");
    updateChart();
  });

  pengeluaranDB.on("value", snap=>{
    totalKeluar = 0;
    snap.forEach(c => totalKeluar += parseInt(c.val().jumlah || 0));
    document.getElementById("totalPengeluaran").innerText = "Rp " + totalKeluar.toLocaleString("id-ID");
    updateChart();
  });

  pelangganDB.on("value", snap=>{
    let count = snap.numChildren();
    document.getElementById("totalPelanggan").innerText = count;
  });

  assetDB.on("value", snap=>{
    let count = snap.numChildren();
    document.getElementById("totalAsset").innerText = count;
  });

  // Chart
  let chart;
  function updateChart(){
    const ctx = document.getElementById("chartKeuangan").getContext("2d");
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Pemasukan", "Pengeluaran"],
        datasets: [{
          label: "Jumlah (Rp)",
          data: [totalMasuk, totalKeluar],
          backgroundColor: ["#28a745", "#dc3545"]
        }]
      }
    });
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
